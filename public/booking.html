<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking</title>
    <link rel="stylesheet" href="booking.css">
</head>

<body>
    <header class="">
        <nav class="gap">
            <div class="logo">
                <div><img src="./assets/3-removebg-preview.png" alt="" height="80px"></div>
                <div>Yatra Nepal</div>
            </div>
            <div class="links">
                <ul>
                    <li><a href="./userdashboard.html">Back to home</a></li>
                </ul>
            </div>
        </nav>
    </header>
    <section id="hero">
        <h1 class="booking-headline">Select your travelling date:</h1>
        <div class="booking-container">
            <div class="form-container">
                <div class="form-group">
                    <label for="from">From</label>
                    <select id="from" class="select-location">
                        <option value="">From</option>
                        <option value="kathmandu">Kathmandu</option>
                        <option value="pokhara">Pokhara</option>
                        <option value="biratnagar">Biratnagar</option>
                        <option value="birgunj">Birgunj</option>
                        <option value="surkhet">Surkhet</option>
                        <option value="dhangadhi">Dhangadhi</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="to">To</label>
                    <select id="to" class="select-location">
                        <option value="">To</option>
                        <option value="kathmandu">Kathmandu</option>
                        <option value="pokhara">Pokhara</option>
                        <option value="biratnagar">Biratnagar</option>
                        <option value="birgunj">Birgunj</option>
                        <option value="surkhet">Surkhet</option>
                        <option value="dhangadhi">Dhangadhi</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="date">Date</label>
                    <input type="date" id="date" class="select-date">
                </div>
                <button type="button" id="search-button" class="btn-search">Search</button>
            </div>
            <div class="results-container" id="bus-results">
                <!-- Bus details will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <footer class="">
        <div class="foot gap">
            <div class="right-foot">
                <h1 class="name">Yatra Nepal</h1>
                <div class="info">
                    <p>Yatra Nepal revolutionizes bus ticket booking with its user-friendly interface, extensive route
                        options, and commitment to convenience. With real-time updates, secure payments, and
                        comprehensive operator information, it's the ultimate destination for hassle-free travel
                        planning. Say goodbye to long queues and uncertaintyâ€”experience the ease and efficiency of Yatra
                        Nepal for all your bus journey needs.</p>
                </div>
            </div>
            <div class="left-foot">
                <div class="abt">
                    <h2>About Us</h2>
                    <ul>
                        <li><a href="#">Project Manager</a></li>
                        <li><a href="#">Business Analyst</a></li>
                        <li><a href="#">Developers</a></li>
                    </ul>
                </div>
                <div class="res">
                    <h2>Resources</h2>
                    <ul>
                        <li>one</li>
                        <li>two</li>
                        <li>three</li>
                    </ul>
                </div>
                <div class="cnt">
                    <h2>Contact Us</h2>
                    <ul>
                        <li>01-333555</li>
                        <li>01-888000</li>
                        <li>+977-9841123456</li>
                        <li>sajilo.safar@contact.com</li>
                    </ul>
                </div>
            </div>
        </div>
        <hr>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var searchButton = document.getElementById('search-button');
            if (searchButton) {
                searchButton.addEventListener('click', function (event) {
                    event.preventDefault();
                    var from = document.getElementById('from').value;
                    var to = document.getElementById('to').value;
                    var date = document.getElementById('date').value;
                    console.log({ from, to, date });
                    fetch('/search-buses', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ from, to, date })
                    })
                        .then(response => response.json())
                        .then(buses => {
                            const resultsContainer = document.getElementById('bus-results');
                            resultsContainer.innerHTML = ''; // Clear previous results

                            if (buses.length > 0) {
                                buses.forEach(bus => {
                                    const busElement = document.createElement('div');
                                    busElement.className = 'bus-item';
                                    busElement.innerHTML = `
                                <h4>${bus.model} - ${bus.registration_number}</h4>
                                <p>Capacity: ${bus.capacity}</p>
                                <p>Status: ${bus.status}</p>
                                <p>Departure: ${bus.departure_time}</p>
                                <p>Arrival: ${bus.arrival_time}</p>
                                <button onclick="bookBus(${bus.bus_id}, ${bus.route_id})">Book Now</button>
                            `;
                                    resultsContainer.appendChild(busElement);
                                });
                            } else {
                                resultsContainer.innerHTML = '<p>No buses found for your search criteria.</p>';
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            resultsContainer.innerHTML = '<p>Error fetching buses. Please try again later.</p>';
                        });
                });
            }
        });

        function bookBus(busId, routeId) {
            // Redirect to the seat selection page
            window.location.href = `seat.html?busId=${busId}&routeId=${routeId}`;
        }
    </script>
</body>

</html>
