<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/d2891741f1.js" crossorigin="anonymous"></script>
    <title>Manage Buses | Bus Management System</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="manage.css">
</head>
<body>
      <!-- ===============Navigation ================ --> 
      <div class="container1">
        <div class="navigation">
            <ul>
                <li>
                    <a href="#">
                        <span class="icon">
                       
                        </span>
                        <span class="title">Bus-managementsystem</span>
                    </a>
                </li>
                <li>
                    <a href="./admindashboard.html">
                        <span class="icon">
                            <ion-icon name="grid-outline"></ion-icon>
                        </span>
                        <span class="title">Dashboard</span>
                      
                    </a>
                </li>

                <li>
                    <a href="./managebus.html">
                        <span class="icon">
                            <ion-icon name="bus-outline"></ion-icon>
                        </span>
                        <span class="title">Manage Buses</span>
                      
                    </a>
                </li>

                <li>
                    <a href="./managedriver.html">
                        <span class="icon">
                            <ion-icon name="people-outline"></ion-icon>
                        </span>
                        <span class="title">Manage Drivers</span>
                    </a>
                </li>

                <li>
                    <a href="./managestationmanager.html">
                        <span class="icon">
                            <ion-icon name="people-outline"></ion-icon>
                        </span>
                        <span class="title">Manage Station Manager</span>
                    </a>
                </li>

                <li>
                    <a href="./manageroutes.html">
                        <span class="icon">
                            <i class="fas fa-route"></i>
                        </span>
                        <span class="title">Manage Routes</span>
                    </a>
                </li>

                <li>
                    <a href="./manageschedule.html">
                        <span class="icon">
                            <ion-icon name="settings-outline"></ion-icon>
                        </span>
                        <span class="title">Manage Schedule</span>
                    </a>
                </li>

                <!-- <li>
                    <a href="#">
                        <span class="icon">
                            <ion-icon name="lock-closed-outline"></ion-icon>
                        </span>
                        <span class="title">Report</span>
                    </a>
                </li> -->

                <!--li>
                    <a href = "#">
                        <span class="icon">
                            <ion-icon name="book-outline"></ion-icon>
                        </span>
                        <span class="title">Contents</span>
                    </a>
                </li-->
                <li>
                    <a href="./login.html" id="signout-link">
                        <span class="icon">
                            <ion-icon name="log-out-outline"></ion-icon>
                        </span>
                        <span class="title">Sign Out</span>
                    </a>
                </li>
            </ul>
        </div>
        <div class="container2 main">
            <div class="topbar">
                <div class="toggle">
                    <ion-icon name="menu-outline"></ion-icon>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2>Manage Buses</h2>
                <button class="add-btn" onclick="showAddBusForm()">Add Bus</button>
            </div>
            <div class="add-bus-form" style="display:none;">
                <form id="addBusForm" action="/addbus" method="POST">
                    <label for="registrationnumber">Registration Number:</label>
                    <input type="text" id="registrationnumber" name="registrationnumber" required>
                    <label for="model">Model:</label>
                    <input type="text" id="model" name="model" required>
                    <label for="capacity">Capacity:</label>
                    <input type="number" id="capacity" name="capacity" required>
                    <label for="status">Status:</label>
                    <select id="status" name="status">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                    <button type="submit">Add Bus</button>
                </form>
            </div>
            <div class="edit-bus-form" style="display:none;">
                <form id="editBusForm">
                    <input type="hidden" id="edit_bus_id" name="bus_id">
                    <label for="edit_registrationnumber">Registration Number:</label>
                    <input type="text" id="edit_registrationnumber" name="registrationnumber" required>
                    <label for="edit_model">Model:</label>
                    <input type="text" id="edit_model" name="model" required>
                    <label for="edit_capacity">Capacity:</label>
                    <input type="number" id="edit_capacity" name="capacity" required>
                    <label for="edit_status">Status:</label>
                    <select id="edit_status" name="status">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                    <button type="button" onclick="submitEditForm()">Save Changes</button>
                </form>
            </div>
            
        
            <div class="card-body">
                <table class="station-table">
                    <thead>
                        <tr>
                            <th>Bus ID</th>
                            <th>License Plate</th>
                            <th>Model</th>
                            <th>Capacity</th>
                            <th>Status</th>
                            
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Bus data will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
       
        function showAddBusForm() {
            var form = document.querySelector('.add-bus-form');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }
        window.onload = function() {
    fetchBuses();
};

function fetchBuses() {
    fetch('/getbuses')
    .then(response => response.json())
    .then(buses => {
        const table = document.querySelector('.station-table tbody');
        table.innerHTML = ''; // Clear existing rows
        buses.forEach(bus => {
            let row = `<tr>
                <td>${bus.bus_id}</td>
                <td>${bus.registration_number}</td>
                <td>${bus.model}</td>
                <td>${bus.capacity}</td>
                <td>${bus.status}</td>
                
            </tr>`;
            table.innerHTML += row;
        });
    })
    .catch(error => console.error('Error loading buses:', error));
}



function deleteBus(busId) {
    console.log('Attempting to delete bus with ID:', busId);
    fetch('/deletebus', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ bus_id: busId })
    })
    .then(() => fetchBuses())  // Refresh list after deletion
    .catch(error => console.error('Error deleting bus:', error));
}

function editBus(busId) {
    console.log('Editing bus:', busId);
    fetch(`/getbus/${busId}`)
    .then(response => response.json())
    .then(bus => {
        document.getElementById('edit_bus_id').value = bus.bus_id;
        document.getElementById('edit_registrationnumber').value = bus.registration_number;
        document.getElementById('edit_model').value = bus.model;
        document.getElementById('edit_capacity').value = bus.capacity;
        document.getElementById('edit_status').value = bus.status;

        var form = document.querySelector('.edit-bus-form');
        form.style.display = 'block';
    })
    .catch(error => console.error('Error loading bus data:', error));
}

    </script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
</body>
</html>